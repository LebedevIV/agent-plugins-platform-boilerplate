# Version Management Rules

## Обзор

Этот документ описывает правила управления версиями в проекте Agent Plugins Platform и правильные команды сборки.

## Критические правила

### ✅ ПРАВИЛЬНЫЕ команды сборки

**ВСЕГДА используйте эти команды для тестирования расширения:**

```bash
# ✅ КОРРЕКТНО - Автоматически увеличивает patch версию
rm -rf dist && pnpm run build

# ✅ КОРРЕКТНО - Только обновление версии
pnpm update-version

# ✅ КОРРЕКТНО - Ручное управление версиями
pnpm update-version patch    # Увеличить patch
pnpm update-version minor    # Увеличить minor
pnpm update-version major    # Увеличить major
pnpm update-version 1.2.3    # Установить конкретную версию
```

### ❌ НЕПРАВИЛЬНЫЕ команды

**НИКОГДА не используйте эти команды для тестирования:**

```bash
# ❌ НЕПРАВИЛЬНО - НЕ увеличивает версию
cd chrome-extension && npm run build

# ❌ НЕПРАВИЛЬНО - Только сборка без обновления версии
npm run build
```

## Почему это важно

### Процесс сборки в корне проекта
```json
"build": "bash bash-scripts/update_version.sh && pnpm set-global-env && pnpm base-build"
```

1. **`update_version.sh`** - автоматически увеличивает patch версию во всех `package.json`
2. **`set-global-env`** - устанавливает глобальные переменные окружения
3. **`base-build`** - выполняет сборку всех пакетов

### Процесс сборки в chrome-extension
```json
"build": "vite build"
```

- Только сборка Vite без обновления версии
- Версия остается неизменной

## Когда использовать правильную сборку

### ✅ Обязательно используйте `pnpm run build` для:

- **Изменения кода расширения** требующие тестирования
- **Модификации плагинов** требующие перезагрузки
- **Обновления DevTools панели** требующие проверки
- **Изменения background скриптов** требующие перезапуска
- **Модификации manifest** требующие переустановки
- **Изменения тестовых скриптов** требующие проверки
- **Любых изменений** требующих перезагрузки расширения

### ✅ Можно использовать `npm run build` только для:

- **Быстрой проверки синтаксиса** без тестирования
- **Отладки ошибок сборки** без обновления версии
- **Разработки** когда версия не важна

## Процесс версионирования

### Автоматическое увеличение версии
```bash
# Увеличивает patch версию (0.5.115 → 0.5.116)
pnpm run build

# Увеличивает patch версию
pnpm update-version

# Увеличивает patch версию
pnpm update-version patch
```

### Ручное управление версиями
```bash
# Увеличить minor версию (0.5.115 → 0.6.0)
pnpm update-version minor

# Увеличить major версию (0.5.115 → 1.0.0)
pnpm update-version major

# Установить конкретную версию
pnpm update-version 1.2.3
```

## Файлы версионирования

### Основные файлы
- `package.json` - корневая версия проекта
- `chrome-extension/package.json` - версия расширения
- `pages/*/package.json` - версии страниц
- `packages/*/package.json` - версии пакетов

### Скрипт обновления
- `bash-scripts/update_version.sh` - автоматическое обновление версий

## Рекомендации для AI ассистентов

### Всегда используйте правильные команды
1. **Для тестирования изменений**: `pnpm run build`
2. **Для обновления версии**: `pnpm update-version`
3. **Для полной очистки**: `rm -rf dist && pnpm run build`

### Проверяйте версию после сборки
```bash
# Проверить текущую версию
grep '"version"' chrome-extension/package.json

# Убедиться, что версия увеличилась
cat chrome-extension/package.json | grep version
```

### Логируйте используемые команды
- Всегда указывайте в комментариях какие команды использовались
- Объясняйте почему выбрана конкретная команда
- Предупреждайте о необходимости перезагрузки расширения

## Примеры использования

### Типичный рабочий процесс
```bash
# 1. Внести изменения в код
# 2. Собрать с обновлением версии
rm -rf dist && pnpm run build

# 3. Перезагрузить расширение в Chrome
# 4. Протестировать изменения
```

### Отладка проблем сборки
```bash
# 1. Быстрая проверка без обновления версии
cd chrome-extension && npm run build

# 2. Если все работает, собрать с обновлением версии
cd .. && pnpm run build
```

### Экстренное обновление версии
```bash
# Если нужно только обновить версию без сборки
pnpm update-version patch
```

## Исключения

### Когда НЕ нужно обновлять версию
- **Изменения в документации** (README, docs)
- **Изменения в конфигурации** (eslint, prettier)
- **Изменения в скриптах** не влияющие на расширение
- **Тестовые файлы** не входящие в сборку

### Когда ОБЯЗАТЕЛЬНО нужно обновлять версию
- **Любые изменения в коде расширения**
- **Изменения в плагинах**
- **Модификации DevTools панели**
- **Обновления background скриптов**
- **Изменения в manifest**

## Контрольный список

### Перед коммитом изменений
- [ ] Использована правильная команда сборки
- [ ] Версия увеличена автоматически
- [ ] Расширение перезагружено в Chrome
- [ ] Изменения протестированы
- [ ] Команды задокументированы в коммите

### При возникновении проблем
- [ ] Проверена правильность команды сборки
- [ ] Убедились в обновлении версии
- [ ] Перезагружено расширение
- [ ] Проверены логи в DevTools
- [ ] Использован правильный контекст DevTools 